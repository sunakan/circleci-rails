version: 2.1
setup: true

orbs:
  continuation: circleci/continuation@1

#
# Dynamic Configurationを利用
#
jobs:
  setup:
    machine:
      image: ubuntu-2404:current
    resource_class: arm.medium
    steps:
      - checkout
      - run:
          name: debug
          command: |
            #!/usr/bin/env sh
            set -eu
            echo "pwd=$(pwd)"
            uname -a
            whoami
            echo "circleci: $(circleci version)" || echo 'circleciが無い'
      - run:
          name: config生成
          command: cd .circleci && bin/generate-config.sh
      - run:
          name: 確認
          command: cat bin/generate-config.sh
workflows:
  dynamic-config:
    jobs:
      - setup
